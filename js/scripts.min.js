var $=jQuery.noConflict();!function(e,t,n,o){var a={getMaxHeight:function(t){var n=e(t).map(function(){return e(this).outerHeight()}).get(),o=Math.max.apply(null,n);return o},wrapEveryNth:function(t,n,o){for(var a=e(t),i=a.length,r=0;r<i;r+=n)a.slice(r,r+n).wrapAll("<div "+("string"==typeof o?'class="'+o+'"':"")+"/>");return a},owlCarouselDefaults:function(e){return{margin:10,nav:!0,autoplay:!1,autoplayTimeout:5e3,autoplaySpeed:500,navSpeed:500,dotsSpeed:500,touchDrag:!0,autoplayHoverPause:!0,pullDrag:!1,mouseDrag:!1,callbacks:!0}},home_slider_carousel:function(){var t=e("#home-slider-carousel"),n=t.attr("data-images"),o=this.owlCarouselDefaults();t.on("initialized.owl.carousel",function(e){}),t.on("resized.owl.carousel",function(e){}),t.on("translate.owl.carousel",function(t){e(this).find(".owl-item .home-slider-item .home-slider-item-text").animate({opacity:0},500)}),t.on("translated.owl.carousel",function(t){e(this).find(".owl-item.center .home-slider-item .home-slider-item-text").animate({opacity:1},500)});var a={loop:t.find(".home-slider-item").size()>1,margin:0,center:n>1,items:n<3?1:2,autoWidth:!0,controlsClass:"home-slider-controls",navText:["",""]},i=e.extend(o,a);t.owlCarousel(i)},place_single_gallery_carousel:function(){var t=e("#place-single-gallery-carousel"),n=t.attr("data-images"),o=this.owlCarouselDefaults();t.on("initialized.owl.carousel",function(n){var o=e(".place-single-image"),a=t.find(".place-single-gallery-item");a.on("click",function(){var t=e(this),n=t.find("img").attr("data-big-image"),a=e('.place-single-image-big[data-thumbnail="'+n+'"]');0===a.length||a.hasClass("visible")||o.stop().animate({opacity:0},300,function(){o.find(".place-single-image-big").removeClass("visible"),a.addClass("visible"),setTimeout(function(){o.stop().animate({opacity:1},300)},200)})})});var a={loop:!1,margin:10,autoWidth:!0,controlsClass:"place-single-gallery-controls",navText:["<i class='color3 absolute-center-both fa fa-angle-left'></i>","<i class='color3 absolute-center-both fa fa-angle-right'></i>"],responsive:{0:{items:n<3?n:3}}},i=e.extend(o,a);t.owlCarousel(i)},bootstrapSelectSettings:function(){},map_init:function(){e("#map-poland").CSSMap({responsive:!1,tooltips:!1,size:960,mapStyle:"custom",disableClicks:!!e(".user-map-poland").length,onClick:function(t){var n=e("#map-poland"),o=n.attr("data-has-info");if("no"!=o){var a=(n.find("ul li"),n.attr("data-link-base")),i=e(t),r=i.attr("data-info-position"),l=i.find("a").attr("href"),s=i.find("a").text(),c=i.find("span.m span."+r)[0].offsetLeft,d=i.find("span.m span."+r)[0].offsetTop,u=i.attr("data-places-found"),p=" obiektów";e(".map-info-box").remove(),1==u&&(p=" obiekt"),(u>1&&u<5||u>21&&u.toString().indexOf("5")!=-1||u>21&&u.toString().indexOf("1")!=-1)&&(p=" obiekty");var f=u>0?'<a href="'+a+l+'" class="btn btn-primary text-uppercase btn-md">Zobacz obiekty</a>':"",g=e("<div></div>",{class:"map-info-box text-center",html:'<p class="no-margin f30 font2 color3 bold">'+u+p+'</p><p class="no-margin color3 text-uppercase">'+s+"</p>"+f+'<div class="map-info-arrow"></div>',css:{position:"absolute","z-index":999}});g.appendTo(n).css("opacity",0);var m=g.outerHeight(),h=g.outerWidth()/2,v=i.find("span.m span."+r).height()/2,b=i.find("span.m span."+r).width()/2;g.css({left:c+b-h,top:d+v-m,opacity:1})}},onLoad:function(t){var n=e("#map-poland-markers"),o=n.attr("data-has-info");if("no"!=o){var a=n.find(".map-marker");a.on("click",function(){var t=e(this),n=t.attr("data-place"),o=t.attr("data-place-link"),i=t.attr("data-county");if(e(".marker-info-box").remove(),t.hasClass("active"))t.removeClass("active");else{var r=e("<div></div>",{class:"marker-info-box map-info-box text-center",html:'<p class="no-margin f30 font2 color3 bold">'+n+'</p><p class="no-margin color3 text-uppercase">'+i+'</p><a href="'+o+'" class="btn btn-primary text-uppercase btn-md">Zobacz obiekt</a><div class="map-info-arrow"></div>',css:{position:"absolute","z-index":999}});r.appendTo(t).css("opacity",0);var l=e(".marker-info-box").outerWidth(),s=t.width();r.css({left:-l/2+s/2,opacity:1}),a.removeClass("active"),t.addClass("active")}})}}})},comments_validation:function(){var t=e("#commentform"),n=e("#comment");t.on("submit",function(t){var o=e.trim(n.val());""===o?(t.preventDefault(),n.addClass("field-error")):n.removeClass("field-error")})},comments_scroll_on_page_change:function(){var n=t.location.hash;if(n.length>0&&e(n).length){var o=e(n).offset().top;e("body, html").stop().animate({scrollTop:o-100},1500)}}};e(n).ready(function(t){e('[data-toggle="tooltip"]').tooltip(),a.bootstrapSelectSettings(),a.map_init(),a.comments_validation()}),e(t).on("load",function(){a.home_slider_carousel(),a.place_single_gallery_carousel(),a.comments_scroll_on_page_change()})}(jQuery,window,document),function(){var e=angular.module("rfsAppDirectives",[]);e.directive("showOnLoad",function(){return{link:function(e,t,n){""===n.ngSrc?(e.place.visible=!0,e.$emit("on-place-loaded","loaded")):t.on("load",function(){e.$apply(function(){e.place.visible=!0,e.$emit("on-place-loaded","loaded")})})}}}),e.directive("placeImg",function(){return{scope:{place:"="},template:'<img show-on-load data-ng-src="{{ place.imageSrc }}" alt="{{ place.imageAlt }}">'}}),e.directive("placeItem",["TPL_PATH","VoteService",function(e,t){return{scope:{contestPlace:"@",place:"=",votingActive:"@"},link:function(e,n,o){e.voting=!1,e.isVotingActive=1==e.votingActive,e.contestPlace&&(e.voted=!1,e.hasVoted=function(t){e.voted=t},e.voteOnPlace=function(){e.voted||e.voting||t.vote(e.place.id,e.contestPlace).then(function(t){"ok"==t.data&&(e.voted=!0)}),e.voting=!0})},templateUrl:e+"place-item.php"}}]),e.directive("piItem",function(){return{template:'<span data-toggle="tooltip" data-placement="top" title="{{ value }}" class="pi-icon pi-{{ key }}"></span>'}}),e.directive("sortByOption",["$rootScope",function(e){return{require:"ngModel",scope:{spoValue:"="},link:function(t,n,o){t.options=t.$parent.sortOptions,t.optionVal=o.spoValue,t.optionLabel=o.spoLabel,n.bind("click",function(){if(n.toggleClass("active"),n.hasClass("active"))t.options.push(o.spoValue);else{var e=t.options.indexOf(o.spoValue);t.options.splice(e,1)}}),e.$on("sortOff",function(e,t){n.removeClass("active")})},template:'<div class="inline-block spo-checkbox"><i class="fa fa-square absolute-center-both"></i><i class="fa fa-square-o absolute-center-both"></i></div><span class="pi-icon pi-{{ optionVal }}"></span><p class="inline-block text-uppercase color2 no-margin">{{ optionLabel }}</p>'}}]),e.directive("regionItem",["TPL_PATH",function(e){return{scope:{singleItem:"=",itemType:"@"},templateUrl:e+"region-item.php",link:function(e,t,n){var o=angular.element(t).find("img");o.on("load",function(){e.$apply(function(){e.singleItem.visible=!0,e.$emit("on-region-loaded","loaded")})})}}}])}(),function(){var e=angular.module("rfsAppServices",[]);e.factory("SiteLoader",function(){var e=!1,t=function(t){e=t},n=function(){return e};return{onSiteLoaded:t,showLoader:n}}),e.factory("AJAXservice",["$http","$httpParamSerializerJQLike","AJAX_URL",function(e,t,n){function o(o){return e({method:"POST",url:n,data:t(o)})}return{ajaxQuery:o}}]),e.factory("VoteService",["AJAXservice",function(e){function t(t,n){var o={action:"voteOnPlace",id:t,nonce:frontendajax.vote_nonce,type:n};return e.ajaxQuery(o)}return{vote:t}}]),e.factory("PlacesSorting",function(){var e=!1,t=function(){return e},n=function(t){e=t};return{isSorting:t,setSorting:n}}),e.factory("scrollToAnchor",["$document",function(e){var t=!1,n=function(e){t=e},o=function(){return t},a=function(t,o,a,i,r,l){var s=angular.element(o),c=parseInt(s.css("height"))+20,d=i,u=t.length,p=u%a,f=0;if(f=0===p?u-a:u-Math.floor(p),r===!0){var g=f*c+d;e.scrollToElementAnimated(l,-g,500)}n(!0)};return{scrollMe:a,enableScroll:o}}])}(),function(){var e=angular.module("rfsAppControllers",["ngSanitize","ngAnimate","duScroll"]);e.controller("PageLoadedController",["$scope","$window","$timeout","SiteLoader",function(e,t,n,o){t.onload=function(){n(function(){angular.element(".body-inner").addClass("view-loaded")},500),o.onSiteLoaded(!0)}}]),e.controller("PageLoaderController",["$scope","SiteLoader",function(e,t){e.$watch(t.showLoader,function(){e.siteLoaded=t.showLoader()})}]),e.controller("LoadPlacesCtrl",["$scope","$rootScope","$document","AJAXservice","PlacesSorting","scrollToAnchor",function(e,t,n,o,a,i){e.places=[],e.page=1,e.lastpage=!1,e.hasData=!0,e.isFilter=!1,e.notFoundByFilter=!1,e.FoundByFilter=0,e.isSortOn=!1,e.exclude=[],e.currentFilter={},e.dynamicData={},e.placeHeight=0,e.enableScroll=!1;var r=angular.element("#placesAnchor");e.$watch(i.enableScroll,function(t){e.enableScroll!==!0&&(e.enableScroll=t)}),e.loadPlaces=function(t,n){e.loading=!0;var i={action:"loadPlaces",ppp:4,page:e.page,exclude:e.exclude},r=angular.extend(i,t);o.ajaxQuery(r).then(function(t){var n=t.data;if(console.log(n),"ok"==n[0]){a.setSorting(!1),n[1].forEach(function(t){e.places.push(t)}),1==e.page&&(e.notFoundByFilter=n[3],e.FoundByFilter=n[5]),e.page+=1,e.hasData=!0,e.lastpage=n[2];for(var o=0;o<n[4].length;o++)e.exclude.push(n[4][o])}else"nodata"==n[0]&&(e.hasData=!1,e.loading=!1);e.loading=!1})},e.imagesLoaded=[],e.$on("on-place-loaded",function(t,n){e.imagesLoaded.push(n),e.imagesLoaded.length==e.places.length&&(e.loading=!1,$('[data-toggle="tooltip"]').tooltip(),i.scrollMe(e.places,".place-item",4,70,e.enableScroll,r))}),e.initLoad=function(t){e.loadPlaces(t)},t.$on("FilterBy",function(n,o){a.setSorting(!1),t.$emit("sortOff",{}),e.isFilter=!0,e.exclude=[],e.hasData=!0,e.imagesLoaded=[],e.places=[],e.page=1,e.currentFilter=o,e.loadPlaces(o)}),t.$on("SortBy",function(t,n){e.isSortOn=!0,e.hasData=!0,e.imagesLoaded=[],e.places=[],e.page=1,e.exclude=[],e.isFilter&&(n.filter=e.currentFilter.filter,n.filterType=e.currentFilter.filterType),e.loadPlaces(n,!0)}),e.$watch(a.isSorting,function(){e.sorting=a.isSorting()},!0)}]),e.controller("SearchPlacesCtrl",["$scope","$rootScope","$document","$location","$timeout","PlacesSorting",function(e,t,n,o,a,i){e.ftIsRegion=!1,e.filterby="none",e.spfInvalid=!1,e.filterType="county",e.sortOptions=[],angular.element(".selectpicker").on("loaded.bs.select",function(e){o.hash()||angular.element(".selectpicker").selectpicker("val","none")}),angular.element(".selectpicker#spf-counties").on("loaded.bs.select",function(t){if(o.hash()){var n=angular.element('#spf-counties [data-county="'+o.hash()+'"]').val();if(angular.isUndefined(n))return;angular.element(".selectpicker").selectpicker("val",n),e.filterby=n,a(function(){angular.element(".spf-filter-submit .btn").trigger("click")},500)}}),angular.element(".selectpicker#spf-regions").on("loaded.bs.select",function(t){if(o.hash()){var n=angular.element('#spf-regions [data-region="'+o.hash()+'"]').val();if(angular.isUndefined(n))return;e.ftIsRegion=!0,e.$watch("ftIsRegion",function(e){e===!0&&(angular.element(".selectpicker").selectpicker("val",n),a(function(){angular.element(".spf-filter-submit .btn").trigger("click")},500))}),e.filterby=n,e.filterType="region"}}),e.$watch("ftIsRegion",function(t,n){t!==n&&(o.hash()||(e.filterby="none"),angular.element(".selectpicker").selectpicker("val","none"))}),e.$watch("ftIsRegion",function(t,n){e.filterType=e.ftIsRegion===!1?"county":"region"}),e.spfCheckValue=function(){e.spfInvalid="none"==e.filterby},e.filterBy=function(){e.spfInvalid="none"==e.filterby,"none"!=e.filterby&&t.$emit("FilterBy",{filter:e.filterby,filterType:e.filterType})},e.sortBy=function(){e.sortOptions.length>0&&(t.$emit("SortBy",{sortBy:e.sortOptions}),i.setSorting(!0))},t.$on("sortOff",function(t,n){e.sortOptions.length=0}),e.$watch(i.isSorting,function(){e.sorting=i.isSorting()},!0)}]),e.controller("RegionsCtrl",["$scope","$window","scrollToAnchor","AJAXservice",function(e,t,n,o){e.region="",angular.element(".selectpicker").on("loaded.bs.select",function(e){var t=angular.element(".selectpicker"),n=angular.element(".regions-list .bootstrap-select");t.selectpicker("val","none");var o=t.find("option").eq(0).val();"none"!=o&&(t.find("option").eq(0).remove(),n.find(".dropdown-menu.inner li").eq(0).remove(),angular.forEach(n.find(".dropdown-menu.inner li"),function(e,t){e.setAttribute("data-original-index",t)}))}),e.goToRegion=function(n){"none"!=e.region&&(history.pushState({},"regions-page",t.location.href),t.location.replace(e.region))},e.regions=[],e.loading=!1,e.lastpage=!1,e.page=2,e.error=!1,e.regionsLoaded=[],e.enableScroll=!0;var a=angular.element("#regionsAnchor");e.$watch(n.enableScroll,function(t){e.enableScroll!==!0&&(e.enableScroll=t)}),e.loadRegions=function(){e.loading=!0;var t={action:"load_regions",nonce:frontendajax.load_regions_nonce,page:e.page};o.ajaxQuery(t).then(function(t){var n=t.data;"ok"==n[0]?(n[1].forEach(function(t){e.regions.push(t)}),e.page=n[2],e.lastpage=n[3]):"nonce"==n[0]})},e.$on("on-region-loaded",function(t,o){e.regionsLoaded.push(o),e.regionsLoaded.length==e.regions.length&&(e.loading=!1,n.scrollMe(e.regions,".region-item",4,0,e.enableScroll,a))})}]),e.controller("WinnersCtrl",["$scope","$window","scrollToAnchor","AJAXservice",function(e,t,n,o){e.winners=[],e.loading=!1,e.lastpage=!1,e.page=1,e.noData=!1,e.winnersLoaded=[],e.enableScroll=!0;angular.element("#placesWinnersAnchor");e.loadWinners=function(t){e.loading=!0;var n={action:"loadWinners",nonce:frontendajax.load_winners_nonce,ppp:4,page:e.page},a=angular.extend(n,t);o.ajaxQuery(a).then(function(t){var n=t.data;"ok"==n[0]?(n[1].forEach(function(t){e.winners.push(t)}),e.page+=1,e.lastpage=n[2]):e.noData=!0})},e.winnersInit=function(t){e.loadWinners(t)},e.$on("on-region-loaded",function(t,n){e.winnersLoaded.push(n),e.winnersLoaded.length==e.winners.length&&(e.loading=!1)})}]),e.controller("LoginCtrl",["$scope","$window","$location","AJAXservice",function(e,t,n,o){function a(){e.iserror=!1,e.error=!1,e.emailError=!1,e.wrong=!1,e.userexists=!1,e.emailexists=!1,e.notexists=!1,e.notactive=!1}function i(t,n){n=n||!1,angular.isDefined(e.forms[t])&&(e.forms[t].$setPristine(),e.forms[t].$setUntouched()),n&&(e.formData={})}e.forms={},e.formData={},e.view="login",e.loading=!1,e.referrer="",e.registered=!1,e.success=!1,e.reset=!1,a(),e.changeView=function(t){e.view=t,a(),e.success=!1,e.reset=!1,angular.forEach(e.forms,function(e,t){i(t)})},e.$watch("forms.registerForm.$valid",function(t,n){t!=n&&(e.iserror=!t)}),"rejestracja"==n.hash()&&(e.changeView("register"),n.hash("")),e.processLogin=function(n){switch(a(),e.success=!1,e.reset=!1,n){case"login":if(e.forms.loginForm.$invalid)return void(e.iserror=!0);e.formData.loginReferrer=e.referrer;break;case"register":if(e.forms.registerForm.$invalid)return void(e.iserror=!0);break;case"remind":if(e.forms.remindForm.$invalid)return void(e.iserror=!0)}e.loading=!0;var r={action:"process_login",nonce:frontendajax.login_nonce,type:n,formData:e.formData};o.ajaxQuery(r).then(function(o){var r=o.data;switch(r[0]){case"ok":switch(n){case"login":t.location.replace(r[1]);break;case"register":e.success=!0,e.registered=!0,e.loading=!1,a(),i("register",!0);break;case"remind":e.success=!0,e.reset=!0,e.loading=!1,a(),i("remind",!0)}break;case"error":switch(e.iserror=!0,e.loading=!1,r[1]){case"wrong":e.wrong=!0;break;case"email":e.emailError=!0;break;case"emailexists":e.emailexists=!0;break;case"userexists":e.userexists=!0;break;case"notexists":e.notexists=!0;break;case"nonce":e.error=!0;break;case"notactive":e.notactive=!0}break;default:e.error=!0}})}}]),e.controller("PremiumCtrl",["$scope","$window","AJAXservice",function(e,t,n){e.promosSelected=[],e.showPayMethods=!1,e.selectedSubscription="",e.nothingSelected=!0,e.paying=!1,e.paymentError=!1,e.showInvoices=!1,e.$watch("tax",function(t){e.tax=t}),_nothingSelected=function(){""===e.selectedSubscription&&e.promosSelected.length<1?e.nothingSelected=!0:(e.nothingSelected=!1,_summary_row(e.selectedSubscription,e.promosSelected))},_tableRow=function(e,t,n){return"<tr><td>"+e+"</td><td>"+t+'</td><td class="summary-row-price"><span>'+n+"</span> PLN</td></tr>"},_summarySumPrices=function(t){var n=angular.element(".summary-vat"),o=0,a=0;if(totalHtml=angular.element(".summary-total"),!(void 0===t||t.length<1)){var i=t.reduce(function(e,t){return parseFloat(e)+parseFloat(t)});o=i*(parseFloat(e.tax)/100),a=parseFloat(i)+parseFloat(o),n.text(parseFloat(o).toFixed(2)+" PLN"),totalHtml.text(parseFloat(a).toFixed(2)+" PLN")}},_summary_row=function(e,t){var n=angular.element(".summary-table"),o="",a="",i=[];if(""!==e){var r=angular.element("#subscription-box-"+e);r.length>0&&(o+=_tableRow(r.find(".subscription-name").text(),r.find(".subscription-term").text(),r.find(".subscription-price span").text()),i.push(r.find(".subscription-price span").text()))}void 0!==t&&t.length>0&&angular.forEach(t,function(e,t){a=angular.element("#promo-box-"+e),a.length>0&&(o+=_tableRow("Reklama - "+a.find(".promo-name-name").text(),"30 dni",a.find(".promo-price").text()),i.push(a.find(".promo-price").text()))}),_summarySumPrices(i),n.find("tbody").html(o)},e.selectSubscription=function(t){e.selectedSubscription=e.selectedSubscription==t?"":t,_nothingSelected()},e.selectPromo=function(t,n){var o=angular.element(n.currentTarget);if(o.toggleClass("checked"),o.hasClass("checked"))e.promosSelected.push(t);else{var a=e.promosSelected.indexOf(t);e.promosSelected.splice(a,1)}_nothingSelected()},e.promoSelected=function(t){return e.promosSelected.indexOf(t)>-1},e.showPaymentMethods=function(){e.showPayMethods=!e.showPayMethods,""===e.selectedSubscription&&e.promosSelected.length<1&&(e.nothingSelected=!0)},e.showInvoicesList=function(){e.showInvoices=!e.showInvoices},e.makePayment=function(o,a){var i=angular.element(".payment-btn"),r=angular.element(o.target),l=r.find(".loader");if(!e.paying){e.paymentError=!1,r.addClass("active"),i.not(".active").addClass("inactive"),l.css("opacity",1);var s={action:"make_payment",nonce:frontendajax.payment_nonce,method:a,subscription:e.selectedSubscription,promos:e.promosSelected};n.ajaxQuery(s).then(function(n){var o=n.data;switch(o[0]){case"ok":t.location.replace(o[1]);break;case"error":e.paymentError=!0}},function(t){e.paymentError=!0}),e.paying=!0}}}]),e.controller("userActionsCtrl",["$scope","AJAXservice",function(e,t){e.seen=!1,e.visit=!1,e.loading=!1,e.action=!1,e.place=0,e.tooltip={},e.$watch("place",function(t){e.place=t}),e.$watch("visit",function(t){e.visit=t,e.tooltip.tovisit=e.visit?"Obiekt znajduje się na Twojej MAPIE MIEJSC Z DUSZĄ":"Zaznacz obiekt na Twojej MAPIE MIEJSC Z DUSZĄ",angular.element(".pua-to-visit").parent().tooltip("hide").attr("data-original-title",e.tooltip.tovisit).tooltip("fixTitle")}),e.$watch("seen",function(t){e.seen=t,e.tooltip.seen=1==e.seen?"Obiekt znajduje się na Twojej MAPIE MIEJSC Z DUSZĄ":"Dodaj obiekt do Twojej MAPY MIEJSC Z DUSZĄ",angular.element(".pua-seen").parent().tooltip("hide").attr("data-original-title",e.tooltip.seen).tooltip("fixTitle")}),e.userAction=function(n){if(!(e.loading||e.seen&&"visit"==n)){e.action=n,e.loading=!0;var o={action:"user_actions",place_id:e.place,nonce:frontendajax.user_action_nonce,type:n,do:e[n]?"remove":"add"};t.ajaxQuery(o).then(function(t){var o=t.data;"ok"==o[0]&&(e[n]=!e[n],"seen"==n&&(e.visit=!1)),e.loading=!1})}}}]),e.animation(".slide-toggle",function(){return{beforeAddClass:function(e,t,n){"ng-hide"===t?e.slideUp(500,n):n()},removeClass:function(e,t,n){"ng-hide"===t?e.hide().slideDown(500,n):n()}}})}(),function(){var e=angular.module("rfsApp",["rfsAppDirectives","rfsAppServices","rfsAppControllers"]);e.constant("AJAX_URL",frontendajax.ajaxurl),e.constant("TPL_PATH",angular.element("body").attr("data-site-url")+"/template-parts/app-templates/"),e.config(["$httpProvider",function(e){e.defaults.cache=!0,e.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8;"}}])}();